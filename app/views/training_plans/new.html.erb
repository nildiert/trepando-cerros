<div class="container mx-auto p-4 flex gap-6">
  <aside class="w-48 space-y-2">
    <ul class="menu bg-base-100 p-2 rounded-box">
      <% if session[:strava_token].present? %>
        <li>
          <%= link_to race_predictor_path, class: ["flex items-center gap-2", (current_page?(race_predictor_path) ? "active" : nil)].compact.join(' ') do %>
            <i class="fa-solid fa-chart-line"></i>
            <span>Calcular Carrera</span>
          <% end %>
        </li>
      <% end %>
      <li>
        <%= link_to training_path, class: ["flex items-center gap-2", (current_page?(training_path) ? "active" : nil)].compact.join(' ') do %>
          <i class="fa-solid fa-dumbbell"></i>
          <span>Entrenamiento</span>
        <% end %>
      </li>
      <% if can?(:manage, TrainingPlan) %>
        <li>
          <%= link_to training_plans_path, class: ["flex items-center gap-2", (current_page?(training_plans_path) ? "active" : nil)].compact.join(' ') do %>
            <i class="fa-solid fa-list-check"></i>
            <span>Planes</span>
          <% end %>
        </li>
      <% end %>
      <li>
        <%= link_to coaches_path, class: ["flex items-center gap-2", (current_page?(coaches_path) ? "active" : nil)].compact.join(' ') do %>
          <i class="fa-solid fa-user"></i>
          <span>Entrenadores</span>
        <% end %>
      </li>
      <% if can? :manage, :athletes %>
        <li>
          <%= link_to athletes_path, class: ["flex items-center gap-2", (current_page?(athletes_path) ? "active" : nil)].compact.join(' ') do %>
            <i class="fa-solid fa-users"></i>
            <span>Atletas</span>
          <% end %>
        </li>
      <% end %>
      <li>
        <%= link_to clubs_path, class: ["flex items-center gap-2", (current_page?(clubs_path) ? "active" : nil)].compact.join(' ') do %>
          <i class="fa-solid fa-people-group"></i>
          <span>Clubes</span>
        <% end %>
      </li>
      <li>
        <%= link_to settings_path, class: ["flex items-center gap-2", (current_page?(settings_path) ? "active" : nil)].compact.join(' ') do %>
          <i class="fa-solid fa-gear"></i>
          <span>Configuración</span>
        <% end %>
      </li>
    </ul>
  </aside>

  <div class="flex-1 space-y-6">
    <div class="card bg-base-100 shadow">
      <div class="card-body">
        <h2 class="text-xl font-semibold mb-4">Nuevo Plan</h2>
        <%= form_with model: @training_plan do |f| %>
          <div class="form-control mb-4">
            <%= f.label :name, 'Nombre', class: 'label' %>
            <%= f.text_field :name, class: 'input input-bordered w-full' %>
          </div>
          <% if @athletes.any? %>
            <div class="form-control mb-4">
              <%= f.label :athlete_id, 'Corredor', class: 'label' %>
              <%= f.select :athlete_id,
                    options_from_collection_for_select(@athletes, :id, ->(u) { u.profile&.athlete_id || u.id }),
                    include_blank: true,
                    class: 'select select-bordered w-full' %>
            </div>
          <% end %>
          <div class="form-control mb-4">
            <%= f.label :description, 'Descripción', class: 'label' %>
            <%= f.text_area :description, rows: 4, class: 'textarea textarea-bordered w-full' %>
          </div>
          <%= f.fields_for :training_plan_days do |day_fields| %>
            <% modal_id = "workout-modal-#{day_fields.object.day}" %>
            <div class="form-control mb-4 border border-base-300 rounded-lg p-2" data-controller="workout-selector" data-workout-selector-toggle-id-value="#{modal_id}">
              <%= day_fields.hidden_field :day %>
              <%= day_fields.hidden_field :workout_type, value: day_fields.object.workout_type, data: { workout_selector_target: 'workoutInput' } %>
              <label for="#{modal_id}" class="label cursor-pointer">
                <span class="label-text"><%= TrainingPlanDay::DAYS_OF_WEEK[day_fields.object.day] %>:</span>
                <span data-workout-selector-target="display" class="<%= workout_color_class(day_fields.object.workout_type) %> badge rounded-lg">
                  <%= t("activerecord.attributes.training_plan_day.workout_types.#{day_fields.object.workout_type}") %>
                </span>
              </label>
              <input type="checkbox" id="#{modal_id}" class="modal-toggle" />
              <div class="modal">
                <div class="modal-box relative rounded-xl">
                  <label for="#{modal_id}" class="btn btn-sm btn-circle absolute right-2 top-2">✕</label>
                  <h3 class="text-lg font-semibold mb-4"><%= t('training_plans.select_activity') %></h3>
                  <div class="flex flex-col gap-2">
                    <% TrainingPlanDay.workout_types.keys.each do |k| %>
                      <% text = t("activerecord.attributes.training_plan_day.workout_types.#{k}") %>
                      <button type="button" class="btn <%= workout_color_class(k) %> rounded-lg" data-action="click->workout-selector#choose" data-workout-value="<%= k %>" data-workout-text="<%= text %>"><%= text %></button>
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
          <div class="flex justify-end">
            <%= f.submit 'Guardar', class: 'btn btn-primary' %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
